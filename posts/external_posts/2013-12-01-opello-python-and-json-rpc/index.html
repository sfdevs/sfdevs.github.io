<!doctype html><html lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>SFDevs | Python and JSON-RPC</title><meta name=description content="In playing with Bitcoin, in this case specifically with the bitcoin-qt client, I found myself wanting to more granularly control which of my coins I spent. This probably isn&rsquo;t something most people care about, or maybe even solve by using multiple wallets, but I thought that it would be nice to choose which addresses were used for transactions. I found that I was not alonein that desire. But sadly, the patch has yet to be merged despite going through a number of iterations."><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link rel=icon href=favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.65.3"><link rel=dns-prefetch href=https://use.fontawesome.com/><link rel=dns-prefetch href=https://fonts.googleapis.com/><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/solid.js integrity=sha384-IA6YnujJIO+z1m4NKyAGvZ9Wmxrd4Px8WFqhFcgRmwLaJaiwijYgApVpo1MV8p77 crossorigin=anonymous></script><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/brands.js integrity=sha384-rUOIFHM3HXni/WG5pzDhA1e2Js5nn4bWudTYujHbbI9ztBIxK54CL4ZNZWwcBQeD crossorigin=anonymous></script><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/fontawesome.js integrity=sha384-EMmnH+Njn8umuoSMZ3Ae3bC9hDknHKOWL2e9WJD/cN6XLeAN7tr5ZQ0Hx5HDHtkS crossorigin=anonymous></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:500,900|Knewave"><link rel=stylesheet href=/styles/main.7b32a4af0453ac69ace05a2f141d3b87f6ed6f4445d64db60685b821c1c4d247.css integrity="sha256-ezKkrwRTrGms4FovFB07h/btb0RF1k22BoW4IcHE0kc="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#6cc091><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#6cc091"><link rel=canonical href=http://opello.org/blog/2013/12/01/python-and-jsonrpc><meta property="og:title" content="Python and JSON-RPC"><meta property="og:description" content="In playing with Bitcoin, in this case specifically with the bitcoin-qt client, I found myself wanting to more granularly control which of my coins I spent. This probably isn&rsquo;t something most people care about, or maybe even solve by using multiple wallets, but I thought that it would be nice to choose which addresses were used for transactions. I found that I was not alonein that desire. But sadly, the patch has yet to be merged despite going through a number of iterations."><meta property="og:type" content="article"><meta property="og:url" content="https://sfdevs.com/posts/external_posts/2013-12-01-opello-python-and-json-rpc/"><meta property="article:published_time" content="2013-12-01T06:00:00+00:00"><meta property="article:modified_time" content="2013-12-01T06:00:00+00:00"><meta property="fb:app_id" content="1171673062996168"><meta itemprop=name content="Python and JSON-RPC"><meta itemprop=description content="In playing with Bitcoin, in this case specifically with the bitcoin-qt client, I found myself wanting to more granularly control which of my coins I spent. This probably isn&rsquo;t something most people care about, or maybe even solve by using multiple wallets, but I thought that it would be nice to choose which addresses were used for transactions. I found that I was not alonein that desire. But sadly, the patch has yet to be merged despite going through a number of iterations."><meta itemprop=datePublished content="2013-12-01T06:00:00+00:00"><meta itemprop=dateModified content="2013-12-01T06:00:00+00:00"><meta itemprop=wordCount content="337"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Python and JSON-RPC"><meta name=twitter:description content="In playing with Bitcoin, in this case specifically with the bitcoin-qt client, I found myself wanting to more granularly control which of my coins I spent. This probably isn&rsquo;t something most people care about, or maybe even solve by using multiple wallets, but I thought that it would be nice to choose which addresses were used for transactions. I found that I was not alonein that desire. But sadly, the patch has yet to be merged despite going through a number of iterations."><meta name=twitter:site content="@_sfdevs"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-89597259-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script>window.fbAsyncInit=function(){FB.init({appId:'1171673062996168',cookie:true,xfbml:true,version:'v3.2'});FB.AppEvents.logPageView();};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/en_US/sdk.js";fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));</script><body class=subpage><header id=header><div class=inner><a href=https://sfdevs.com/ class=logo>SFDevs</a><nav id=nav role=menu><a href=/about/><span>About</span></a>
<a href=/posts/><span>Community Posts</span></a>
<a href=/events/><span>Events</span></a>
<a href=/jobs/><span>Jobs</span></a></nav><a href=#navPanel class=navPanelToggle><span class="fa fa-bars"></span></a></div></header><section class=wrapper><div class=inner><header class=align-center><h1>Python and JSON-RPC</h1></header><p>In playing with <a href=http://bitcoin.org/>Bitcoin</a>, in this case specifically with
the <a href=https://github.com/bitcoin/bitcoin>bitcoin-qt</a> client, I found myself
wanting to more granularly control which of my coins I spent. This probably
isn&rsquo;t something most people care about, or maybe even solve by using multiple
wallets, but I thought that it would be nice to choose which addresses were used
for transactions. I found that I was not
alone in that desire. But sadly,
the patch has yet to be merged despite going through a number of iterations.</p><p>Enter <code>contrib/spendfrom/spendfrom.py</code>. This Python script purported to solve
the problem to some extent. But it wasn&rsquo;t quite as easy as I had hoped to get
working. There is a
<a href=https://github.com/bitcoin/bitcoin/blob/master/contrib/spendfrom/README.md><code>README.md</code></a>
that highlights a dependency on &ldquo;jsonrpc.&rdquo; That seemed easy enough, since I run
Windows on this particular machine, I tried using
<code>C:\Python27\Scripts\easy_install.exe jsonrpc</code> which indeed installed
<a href=https://pypi.python.org/pypi/jsonrpc/>jsonrpc</a> just not the one linked in
the documentation, which I
overlooked.</p><p>Once I got the right <code>jsonrpc</code> checked out from Bazaar, and copied to my
<code>site-packages</code> directory, I thought I was good to go. However, I ran into a
problem that <code>spendfrom.py</code> tests for:</p><pre><code>def check_json_precision():
    &amp;quot;&amp;quot;&amp;quot;Make sure json library being used does not lose precision converting BTC values&amp;quot;&amp;quot;&amp;quot;
    n = Decimal(&amp;quot;20000000.00000003&amp;quot;)
    satoshis = int(json.loads(json.dumps(float(n)))*1.0e8)
    if satoshis != 2000000000000003:
        raise RuntimeError(&amp;quot;JSON encode/decode loses precision&amp;quot;)

</code></pre><p>So I started digging, and found that the <code>json</code> object that <code>jsonrpc</code> comes
with did some serialization by using
<a href="http://docs.python.org/2/library/functions.html?highlight=unicode#unicode"><code>unicode()</code></a>
that showed a loss of precision with the given value. This was pretty easy to
verify, and I pushed a
change
to a github hosted version of the json-rpc.org bzr repository, thanks to
<code>git-remote-bzr</code>. The change inserts a call to
<a href="http://docs.python.org/2/library/functions.html?highlight=repr#repr"><code>repr()</code></a>
before passing that string to <code>unicode()</code>.</p><p>Finally, to get everything to work, I replaced all of the uses of <code>Decimal()</code>
in the <code>spendfrom.py</code> script to just use <code>float()</code> and have not seen any
issues. Granted I have not done a huge number of transactions, nor have I done
any that were more than four decimal places. Hopefully I didn&rsquo;t introduce some
insidious bug.</p></div></section><footer id=footer><div class=inner><h3>Get in touch</h3><iframe src="https://services.cognitoforms.com/f/kLQF89okA06rKO0JYMWNOg?id=1" style=position:relative;width:1px;min-width:100%;*width:100% frameborder=0 scrolling=yes seamless height=465 width=100%></iframe>
<script src=https://services.cognitoforms.com/scripts/embed.js></script><div class="row footer__copy-social"><div class="copyright 6u 12u$(small)">&copy; 2020 Sioux Falls Developer's Group.</div><div class="6u 12u$(small) social"><div class=footer__social><span class=follow__social__copy>Follow SFDevs</span>
<a href=https://www.facebook.com/sfdevs title="Follow us on Facebook" class=like-us target=_blank rel=noopener><i class="fab fa-facebook fa-2x"></i></a><a href=https://twitter.com/_sfdevs title="Follow us on Twitter" class=like-us target=_blank rel=noopener><i class="fab fa-twitter fa-2x"></i></a></div></div></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin=anonymous></script><script src=/js/skel.min.js></script><script src=/js/main.min.js></script></body></html>