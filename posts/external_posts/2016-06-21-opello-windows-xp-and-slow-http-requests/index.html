<!doctype html><html lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>SFDevs | Windows XP and Slow HTTP Requests</title><meta name=description content="This week at work I was faced with a bug that manifested as Windows XP clients being slower to access parts of a web interface than Windows 7 or 10. This was strange because in Wireshark the requests looked basically the same.
It turned out that the embedded system hosting the web interface was rejecting Ethernet frames larger than 1500 bytes. This was most likely because of a misinterpretation of the MTU as referring to the frame size (at layer 2) instead of the payload size (at layer 3)."><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link rel=icon href=favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.56.0"><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/solid.js integrity=sha384-IA6YnujJIO+z1m4NKyAGvZ9Wmxrd4Px8WFqhFcgRmwLaJaiwijYgApVpo1MV8p77 crossorigin=anonymous></script><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/brands.js integrity=sha384-rUOIFHM3HXni/WG5pzDhA1e2Js5nn4bWudTYujHbbI9ztBIxK54CL4ZNZWwcBQeD crossorigin=anonymous></script><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/fontawesome.js integrity=sha384-EMmnH+Njn8umuoSMZ3Ae3bC9hDknHKOWL2e9WJD/cN6XLeAN7tr5ZQ0Hx5HDHtkS crossorigin=anonymous></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:500,900|Knewave"><link rel=stylesheet href=/styles/main.c1af6829ba8f007e9a41864163894b2474ad2b5f7b38b6def082239dd6da9cf3.css integrity="sha256-wa9oKbqPAH6aQYZBY4lLJHStK197OLbe8IIjndbanPM="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#6cc091><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#6cc091><link rel=canonical href=http://opello.org/blog/2016/06/21/windows-xp-and-slow-http-requests><meta property=og:title content="Windows XP and Slow HTTP Requests"><meta property=og:description content="This week at work I was faced with a bug that manifested as Windows XP clients being slower to access parts of a web interface than Windows 7 or 10. This was strange because in Wireshark the requests looked basically the same.
It turned out that the embedded system hosting the web interface was rejecting Ethernet frames larger than 1500 bytes. This was most likely because of a misinterpretation of the MTU as referring to the frame size (at layer 2) instead of the payload size (at layer 3)."><meta property=og:type content=article><meta property=og:url content=https://sfdevs.com/posts/external_posts/2016-06-21-opello-windows-xp-and-slow-http-requests/><meta property=article:published_time content=2016-06-21T05:00:00+00:00><meta property=article:modified_time content=2016-06-21T05:00:00+00:00><meta property=fb:app_id content=1171673062996168><meta itemprop=name content="Windows XP and Slow HTTP Requests"><meta itemprop=description content="This week at work I was faced with a bug that manifested as Windows XP clients being slower to access parts of a web interface than Windows 7 or 10. This was strange because in Wireshark the requests looked basically the same.
It turned out that the embedded system hosting the web interface was rejecting Ethernet frames larger than 1500 bytes. This was most likely because of a misinterpretation of the MTU as referring to the frame size (at layer 2) instead of the payload size (at layer 3)."><meta itemprop=datePublished content=2016-06-21T05:00:00&#43;00:00><meta itemprop=dateModified content=2016-06-21T05:00:00&#43;00:00><meta itemprop=wordCount content=367><meta itemprop=keywords content><meta name=twitter:card content=summary><meta name=twitter:title content="Windows XP and Slow HTTP Requests"><meta name=twitter:description content="This week at work I was faced with a bug that manifested as Windows XP clients being slower to access parts of a web interface than Windows 7 or 10. This was strange because in Wireshark the requests looked basically the same.
It turned out that the embedded system hosting the web interface was rejecting Ethernet frames larger than 1500 bytes. This was most likely because of a misinterpretation of the MTU as referring to the frame size (at layer 2) instead of the payload size (at layer 3)."><meta name=twitter:site content=@_sfdevs><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-89597259-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script>window.fbAsyncInit=function(){FB.init({appId:'1171673062996168',cookie:true,xfbml:true,version:'v3.2'});FB.AppEvents.logPageView();};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/en_US/sdk.js";fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));</script><body class=subpage><header id=header><div class=inner><a href=https://sfdevs.com/ class=logo>SFDevs</a><nav id=nav role=menu><a href=/about/><span>About</span></a>
<a href=/posts/><span>Community Posts</span></a>
<a href=/jobs/><span>Jobs</span></a></nav><a href=#navPanel class=navPanelToggle><span class="fa fa-bars"></span></a></div></header><section class=wrapper><div class=inner><header class=align-center><h1>Windows XP and Slow HTTP Requests</h1></header><p>This week at work I was faced with a bug that manifested as Windows XP clients
being slower to access parts of a web interface than Windows 7 or 10. This was
strange because in Wireshark the requests looked basically the same.</p><p>It turned out that the embedded system hosting the web interface was rejecting
Ethernet frames larger than 1500 bytes. This was most likely because of a
misinterpretation of the MTU as referring to the frame size (at layer 2) instead
of the payload size (at layer 3).</p><p>The strangest part about this issue was just how consistent the effect was
across all browsers tested given a version of Windows. Windows XP took nearly
22 seconds to complete a request that took just over 2 seconds in Windows 7.
The core of this behavior ended up being a side-effect of the TCP retransmission
timeout.</p><p>The default retransmission timeout for Windows XP is stored in the
<code>TCPInitialRTT</code> registry value for a given network adapter. The default
value when the registry value does not exist <a href=https://support.microsoft.com/en-us/kb/170359>is
3000ms</a>. This aligned with the
observation under XP that the first retransmission occurred after 3
seconds with subsequent retransmissions occurring at 6 and 12 seconds. The
first retransmission was sent unfragmented while the second and third
retransmissions were a fragmented version of the original frame, which was
ultimately accepted. The fragmented payloads were at most 576 bytes which
seemed like an interesting size but I did not investigate.</p><p>Windows 7 on the other hand appears to retry after 300 milliseconds, with
subsequent retries at 600ms and 1200ms. But the same basic behavior was
followed: the first retry was the full payload while the subsequent retries
were fragmented into at most 576 byte payloads. The key difference appearing
to be the retransmission timeout. This masked the underlying issue for Windows
7 clients.</p><p>While I did not search extensively I did not find an explanation for either the
doubling back-off of the retransmissions or the 576 byte payload size.</p><p>The rather quick fix was to change the Linux driver to accept frames up to the
actual size that could be handled. And introducing an error message if a frame
is rejected for length reasons.</p></div></section><footer id=footer><div class=inner><h3>Get in touch</h3><iframe src="https://services.cognitoforms.com/f/kLQF89okA06rKO0JYMWNOg?id=1" style=position:relative;width:1px;min-width:100%;*width:100% frameborder=0 scrolling=yes seamless height=465 width=100%></iframe>
<script src=https://services.cognitoforms.com/scripts/embed.js></script><div class="row footer__copy-social"><div class="copyright 6u 12u$(small)">&copy; 2019 Sioux Falls Developer's Group.</div><div class="6u 12u$(small) social"><div class=footer__social><span class=follow__social__copy>Follow SFDevs</span>
<a href=https://www.facebook.com/sfdevs title="Follow us on Facebook" class=like-us target=_blank rel=noopener><i class="fab fa-facebook fa-2x"></i></a><a href=https://twitter.com/_sfdevs title="Follow us on Twitter" class=like-us target=_blank rel=noopener><i class="fab fa-twitter fa-2x"></i></a></div></div></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin=anonymous></script><script src=/js/skel.min.js></script><script src=/js/main.min.js></script></body></html>