<!doctype html><html lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>SFDevs | Public Cert Trust Stores in Ruby: What am I trusting and should I be? The internet is scary</title><meta name=description content="When I was a senior in college (longer ago than I should admit to) I did a demonstration about sniffing user’s facebook traffic when they were using wifi at my college. At the time Facebook didn’t redirect HTTP -> HTTPS by default and most users were connecting over plaintext.
Since then Facebook has switched to secure browsing by default, and most companies are encrypting traffic in transit whether it’s internal or external."><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link rel=icon href=favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.69.2"><link rel=dns-prefetch href=https://use.fontawesome.com/><link rel=dns-prefetch href=https://fonts.googleapis.com/><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/solid.js integrity=sha384-IA6YnujJIO+z1m4NKyAGvZ9Wmxrd4Px8WFqhFcgRmwLaJaiwijYgApVpo1MV8p77 crossorigin=anonymous></script><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/brands.js integrity=sha384-rUOIFHM3HXni/WG5pzDhA1e2Js5nn4bWudTYujHbbI9ztBIxK54CL4ZNZWwcBQeD crossorigin=anonymous></script><script defer src=https://use.fontawesome.com/releases/v5.8.1/js/fontawesome.js integrity=sha384-EMmnH+Njn8umuoSMZ3Ae3bC9hDknHKOWL2e9WJD/cN6XLeAN7tr5ZQ0Hx5HDHtkS crossorigin=anonymous></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:500,900|Knewave"><link rel=stylesheet href=/styles/main.51f1d62c8d67116f4b680be7c16712f5749f82f8e2fc7bbab9cc042476e51041.css integrity="sha256-UfHWLI1nEW9LaAvnwWcS9XSfgvji/Hu6ucwEJHblEEE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#6cc091><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#6cc091"><link rel=canonical href=https://rollingwebsphere.home.blog/2020/04/11/public-cert-trust-stores-in-ruby-what-am-i-trusting-and-should-i-be-the-internet-is-scary/><meta property="og:title" content="Public Cert Trust Stores in Ruby: What am I trusting and should I be? The internet is scary"><meta property="og:description" content="When I was a senior in college (longer ago than I should admit to) I did a demonstration about sniffing user’s facebook traffic when they were using wifi at my college. At the time Facebook didn’t redirect HTTP -> HTTPS by default and most users were connecting over plaintext.
Since then Facebook has switched to secure browsing by default, and most companies are encrypting traffic in transit whether it’s internal or external."><meta property="og:type" content="article"><meta property="og:url" content="https://sfdevs.com/posts/external_posts/2020-04-11-brian-olson-public-cert-trust-stores-in-ruby-what-am-i-trusting-and-should-i-be-the-internet-is-scary/"><meta property="article:published_time" content="2020-04-11T15:27:00+00:00"><meta property="article:modified_time" content="2020-04-11T15:27:00+00:00"><meta itemprop=name content="Public Cert Trust Stores in Ruby: What am I trusting and should I be? The internet is scary"><meta itemprop=description content="When I was a senior in college (longer ago than I should admit to) I did a demonstration about sniffing user’s facebook traffic when they were using wifi at my college. At the time Facebook didn’t redirect HTTP -> HTTPS by default and most users were connecting over plaintext.
Since then Facebook has switched to secure browsing by default, and most companies are encrypting traffic in transit whether it’s internal or external."><meta itemprop=datePublished content="2020-04-11T15:27:00+00:00"><meta itemprop=dateModified content="2020-04-11T15:27:00+00:00"><meta itemprop=wordCount content="606"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Public Cert Trust Stores in Ruby: What am I trusting and should I be? The internet is scary"><meta name=twitter:description content="When I was a senior in college (longer ago than I should admit to) I did a demonstration about sniffing user’s facebook traffic when they were using wifi at my college. At the time Facebook didn’t redirect HTTP -> HTTPS by default and most users were connecting over plaintext.
Since then Facebook has switched to secure browsing by default, and most companies are encrypting traffic in transit whether it’s internal or external."><meta name=twitter:site content="@_sfdevs"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-89597259-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><body class=subpage><header id=header><div class=inner><a href=https://sfdevs.com/ class=logo>SFDevs</a><nav id=nav role=menu><a href=/about/><span>About</span></a>
<a href=/posts/><span>Community Posts</span></a>
<a href=/events/><span>Events</span></a>
<a href=/jobs/><span>Jobs</span></a></nav><a href=#navPanel class=navPanelToggle><span class="fa fa-bars"></span></a></div></header><section class=wrapper><div class=container><header class=align-center><h1>Public Cert Trust Stores in Ruby: What am I trusting and should I be? The internet is scary</h1></header><article><p>When I was a senior in college (longer ago than I should admit to) I did a demonstration about sniffing user’s facebook traffic when they were using wifi at my college. At the time Facebook didn’t redirect HTTP -> HTTPS by default and most users were connecting over plaintext.</p><p>Since then Facebook has switched to <a href=https://www.facebook.com/notes/facebook-engineering/secure-browsing-by-default/10151590414803920>secure browsing by default</a>, and most companies are encrypting traffic in transit whether it’s internal or external. With that sprawl of encryption it’s can be important to have some understanding of how root <a href=https://en.wikipedia.org/wiki/Root_certificate>signing certificates work</a>, and understand what root certificates your system is trusting. For this post we’ll work with HTTPS clients in Ruby (specifically <a href=https://github.com/jnunemaker/httparty>HTTParty</a>).</p><h3 id=when-should-you-care-about-what-your-library-trusts>When should you care about what your library trusts?</h3><p>Most of the time you don’t need to worry about it. HTTP libraries and most OS’s come with a default set of public certs they trust. If you’re curious (and on windows) you can check your machine’s listing by running Start -> MMC and adding the certificates snap in for your computer account</p><p>It’s a pretty standard list of names you might recognize like DigiCert, GlobalSign, etc. These let your computer trust a normal list of services, and as long as a service takes the time to get a certificate from one of these CA’s you’ll be able to connect to it.</p><p>So when should you be worried about what certs your library trusts?</p><ol><li>When you might be working with Self Signed certs (like on an internal network)1. When you have a very old client that may not have an up to date list1. If you’re service is using a newer trust authority like LetsEncrypt</li></ol><h3 id=starting-at-the-top>Starting at the top</h3><p>HTTPary has an initialize method that let’s you set the HTTP scheme (HTTPS/HTTP)</p><p><a href=https://www.rubydoc.info/github/jnunemaker/httparty/HTTParty/Request#initialize-instance_method>https://www.rubydoc.info/github/jnunemaker/httparty/HTTParty/Request#initialize-instance_method</a></p><p>Which lets you decide if you’re going to make a secure or a plaintext request</p><h3 id=finding-our-defaults>Finding our defaults</h3><p>Now that we know we’re going to make a secure request, we need to understand what our library will do by default. There are two methods for setting a CA file, or a CA path</p><p><a href=https://www.rubydoc.info/github/jnunemaker/httparty/HTTParty/ClassMethods#ssl_ca_file-instance_method>https://www.rubydoc.info/github/jnunemaker/httparty/HTTParty/ClassMethods#ssl_ca_file-instance_method</a></p><p><a href=https://www.rubydoc.info/github/jnunemaker/httparty/HTTParty/ClassMethods#ssl_ca_path-instance_method>https://www.rubydoc.info/github/jnunemaker/httparty/HTTParty/ClassMethods#ssl_ca_path-instance_method</a></p><p>Unfortunately there is no description in the doc of what the library will use by default. That’s not really a knock on the developer, most of the time you don’t have to worry about it.</p><p>For let’s dive into the source code: <a href=https://github.com/jnunemaker/httparty/blob/master/lib/httparty.rb#L427>https://github.com/jnunemaker/httparty/blob/master/lib/httparty.rb#L427</a></p><p>And there we see a method that will set the default options.</p><p>To be frank, this is where my Ruby knowledge breaks down. The next reference I can find to the default cert store is here</p><p><a href=https://github.com/jnunemaker/httparty/blob/master/lib/httparty/connection_adapter.rb#L81>https://github.com/jnunemaker/httparty/blob/master/lib/httparty/connection_adapter.rb#L81</a></p><pre><code>docker run -it ruby /bin/bash&lt;/code&gt;&lt;/p&gt;



Then we jump into the interactive ruby console by typing `irb` and importing OpenSSL package by typing `require 'openssl'`. Lastly we can print what the default cert directory with `print(OpenSSL::X509::DEFAULT_CERT_DIR)`



&lt;pre class=&quot;wp-block-code&quot;&gt;&lt;code&gt;irb(main):002:0&amp;gt; print(OpenSSL::X509::DEFAULT_CERT_DIR)
/usr/lib/ssl/certs=&amp;gt; nil
</code></pre><p>And it turns out <code>/us/lib/ssl/certs</code> is a link to <code>/etc/ssl/certs</code></p><pre><code>root@caf6415446ff:/# ls -l /usr/lib/ssl/certs
lrwxrwxrwx 1 root root 14 Oct 12 19:56 /usr/lib/ssl/certs -&amp;gt; /etc/ssl/certs
</code></pre><p>Which has a ton of certs in it</p><pre><code>root@caf6415446ff:/# ls -l /etc/ssl/certs/ | wc -l
258
</code></pre><p>And there you have it! Now you can comb through the certs in this directory.</p><h2 id=final-thoughts>Final thoughts</h2><p>Certs are intimidating when you get started because they seem like magic, and they’re plenty complicated. But at the same time you can abstract some of that complexity away by understanding some basics like when your cert trust store matters.</p><p>I went into some detail on finding the default trust store because I think it’s helpful to see that you can make a lot of progress understanding certs just by digging through a repo and looking at source code.</p></article></div></section><footer id=footer><div class=container><h3>Get in touch</h3><iframe src="https://services.cognitoforms.com/f/kLQF89okA06rKO0JYMWNOg?id=1" style=position:relative;width:1px;min-width:100%;*width:100% frameborder=0 scrolling=yes seamless height=465 width=100%></iframe>
<script src=https://services.cognitoforms.com/scripts/embed.js></script><div class="row footer__copy-social"><div class="copyright col-md-6">&copy; 2020 Sioux Falls Developer's Group.</div><div class="col-md-6 social"><div class=footer__social><span class=follow__social__copy>Follow SFDevs</span>
<a href=https://www.facebook.com/sfdevs title="Follow us on Facebook" class=like-us target=_blank rel=noopener><i class="fab fa-facebook fa-2x"></i></a><a href=https://twitter.com/_sfdevs title="Follow us on Twitter" class=like-us target=_blank rel=noopener><i class="fab fa-twitter fa-2x"></i></a></div></div></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin=anonymous></script><script src=/js/skel.min.js></script><script src=/js/main.min.js></script></body></html>